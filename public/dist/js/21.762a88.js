(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{110:function(t,e,n){"use strict";n.r(e);var a=n(0),r=n.n(a),o=n(4),s=n.n(o),i=(n(246),n(11)),l=n.n(i);n(15);function c(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},a=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),a.forEach(function(e){u(t,e,n[e])})}return t}function u(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function d(t,e,n,a,r,o,s){try{var i=t[o](s),l=i.value}catch(t){return void n(t)}i.done?e(l):Promise.resolve(l).then(a,r)}function h(t){return function(){var e=this,n=arguments;return new Promise(function(a,r){var o=t.apply(e,n);function s(t){d(o,a,r,s,i,"next",t)}function i(t){d(o,a,r,s,i,"throw",t)}s(void 0)})}}var f={components:{VueCtkDateTimePicker:l.a},created:function(){var t=h(r.a.mark(function t(){return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.$store.getters["tables/tables"].length){t.next=3;break}return t.next=3,this.$store.dispatch("tables/fetchTables");case 3:return t.next=5,this.$store.dispatch("shows/fetchShows");case 5:return t.next=7,this.$store.dispatch("performances/fetchPerformances");case 7:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),mounted:function(){},data:function(){return{selectedShow:null,selectedTable:null,newTablesArray:[],newPerformance:{show_id:"",name:"",location:"",date:""},newPlan:{svg_id:"",name:""}}},computed:{loading:function(){return this.$store.getters.loading},loadedTables:function(){return this.$store.getters["tables/tables"]},loadedShows:function(){return this.$store.getters["shows/shows"]}},methods:{updateShowId:function(){var t=Math.random().toString(36).substr(2,9);this.newPlan.svg_id=t,this.newPerformance.show_id=this.selectedShow.id},formattedTableNumber:function(t){return("0"+t).slice(-2)},clickOnTablesPlan:function(){var t=h(r.a.mark(function t(e){var n,a;return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:try{n=e.target.id,a=n.substring(0,n.indexOf("_")),this.selectedTable&&this.selectedTable.svg_id&&s.a.get("".concat(this.selectedTable.svg_id,"_table")).attr("stroke",null),"tables_plan"!=n?(this.selectedTable=this.newTablesArray.find(function(t){return t.svg_id===a}),s.a.get("".concat(a,"_table")).attr("stroke","#FF0000").attr("stroke-width",1)):(console.log("Click on blank space"),this.selectedTable=null)}catch(t){console.log("error: ",t)}case 1:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}(),addTable:function(){var t=h(r.a.mark(function t(e){var n,a,o,i,l,u,d,h,f=this;return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:n=c({},e),a=e.r/2,o=Math.random().toString(36).substr(2,9),i="01",l=s()("tables_plan").svg(),u=l.match(/data-table-number="\d+"/g),d=[],u&&(u.forEach(function(t){return d.push(parseInt(t.match(/\d+/g)[0]))}),console.log("array: ",d),i=d.reduce(function(t,e){return t>e?f.formattedTableNumber(parseInt(t)+1):f.formattedTableNumber(parseInt(e)+1)},i)),console.log("tableNumber: ",i),n.svg_id=o,n.table_number=i,this.newTablesArray.push(n),"circle"===e.svg_type&&((h=s()("tables_plan").group().attr({id:"".concat(o,"_group")}).draggable({minX:-(s()("tables_plan").viewbox().width/2-a),maxX:s()("tables_plan").viewbox().width/2+a,minY:-(s()("tables_plan").viewbox().height/2-a),maxY:s()("tables_plan").viewbox().height/2+a}).addClass("table")).circle(e.r).attr({cx:s()("tables_plan").viewbox().width/2,cy:s()("tables_plan").viewbox().height/2,id:"".concat(o,"_table"),"data-svg-model":e.svg_model,"data-total-seats":e.total_seats,"data-table-number":i}),h.text("").attr({id:"".concat(o,"_text")}).tspan(i).attr({id:"".concat(o,"_span")}).font({family:"Helvetica",size:10,dx:s()("tables_plan").viewbox().width/2-6,dy:s()("tables_plan").viewbox().height/2+3,fill:"#9ACD32"})),"path"==e.svg_type&&s()("tables_plan").path(e.d).attr({id:o,"data-svg-model":e.svg_model,"data-total-seats":e.total_seats}).draggable().addClass("table");case 14:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}(),savePlan:function(){var t=h(r.a.mark(function t(){var e;return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,this.$store.commit("SET_LOADING",!0,{root:!0}),this.selectedTable&&this.selectedTable.svg_id&&s.a.get("".concat(this.selectedTable.svg_id,"_table")).attr("stroke",null),t.next=5,this.$store.dispatch("plans/createPlan",{newPlanSVG:s()("tables_plan").svg(),newPlan:this.newPlan,newTablesArray:this.newTablesArray,newPerformance:this.newPerformance});case 5:e=t.sent,console.log("def: ",e),this.$store.commit("SET_LOADING",!1),this.$noty.success("Le plan de salle a été créer avec succès. Vous allez être redirigé vers la page des plans."),setTimeout(function(){window.location.href="../plans"},1e3),t.next=17;break;case 12:t.prev=12,t.t0=t.catch(0),this.$store.commit("SET_LOADING",!1),console.log("error: ",t.t0),this.$noty.error("Une erreur est apparue et le plan de salle n'a pas pu être créer.");case 17:case"end":return t.stop()}},t,this,[[0,12]])}));return function(){return t.apply(this,arguments)}}(),deleteTable:function(){var t=h(r.a.mark(function t(){return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:try{s.a.get("".concat(this.selectedTable.svg_id,"_group")).remove(),this.selectedTable=null}catch(t){this.$noty.error("Nous sommes désolés. Une erreur est survenue et la table n'a pas pu être supprimée.")}case 1:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()}},m=(n(287),n(2)),b=Object(m.a)(f,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("b-container",[n("b-breadcrumb",[n("b-breadcrumb-item",{attrs:{to:"/admin/plans"}},[n("font-awesome-icon",{attrs:{icon:"chair"}}),t._v(" Plans de salle")],1),t._v(" "),n("b-breadcrumb-item",{attrs:{active:""}},[t._v("Créer")])],1),t._v(" "),n("h2",{staticClass:"text-center"},[t._v("Créer un nouveau plan")]),t._v(" "),n("b-row",{staticClass:"justify-content-center my-3 px-3"},[n("b-col",{attrs:{cols:"12",md:"6"}},[n("b-form-group",{attrs:{label:"Entrer un nom pour le nouveau plan:","label-for":"newPlanName"}},[n("b-form-input",{attrs:{type:"text",required:"",placeholder:"Plan n° 1",id:"newPlanName"},model:{value:t.newPlan.name,callback:function(e){t.$set(t.newPlan,"name",e)},expression:"newPlan.name"}})],1)],1),t._v(" "),n("b-col",{attrs:{cols:"12",md:"6"}},[n("b-form-group",{attrs:{label:"Sélectionner le spectacle:","label-for":"newPlanShow"}},[n("b-form-select",{attrs:{id:"newPlanShow"},on:{change:t.updateShowId},model:{value:t.selectedShow,callback:function(e){t.selectedShow=e},expression:"selectedShow"}},t._l(t.loadedShows,function(e){return n("option",{key:e.id,domProps:{value:e}},[t._v(t._s(e.name))])}),0)],1)],1)],1),t._v(" "),t.selectedShow?n("b-row",{staticClass:"justify-content-start my-3 px-3"},[n("b-col",{attrs:{cols:"12",md:"6"}},[n("b-form-group",{attrs:{label:"Entrer un nom pour cette représentation:","label-for":"newPerformanceName"}},[n("b-form-input",{attrs:{id:"newPerformanceName",placeholder:"Représentation n°1"},model:{value:t.newPerformance.name,callback:function(e){t.$set(t.newPerformance,"name",e)},expression:"newPerformance.name"}})],1)],1),t._v(" "),n("b-col",{attrs:{cols:"12",md:"6"}},[n("b-form-group",{attrs:{label:"Entrer un lieu pour cette représentation:","label-for":"newPerformanceLocation"}},[n("b-form-input",{attrs:{id:"newPerformanceLocation",placeholder:"Beaulieu, Morges"},model:{value:t.newPerformance.location,callback:function(e){t.$set(t.newPerformance,"location",e)},expression:"newPerformance.location"}})],1)],1),t._v(" "),n("b-col",{attrs:{cols:"12",md:"6"}},[n("b-form-group",{attrs:{label:"Entrer une date pour cette représentation:","label-for":"newPerformanceDate"}},[n("VueCtkDateTimePicker",{attrs:{label:"Cliquer pour choisir une date",format:"YYYY-MM-DD HH:mm",formatted:"YYYY-MM-DD HH:mm",color:"#9ACD32","button-color":"#9ACD32","button-now-translation":"Aujourd'hui",id:"newPerformanceDate"},model:{value:t.newPerformance.date,callback:function(e){t.$set(t.newPerformance,"date",e)},expression:"newPerformance.date"}})],1)],1)],1):t._e(),t._v(" "),n("b-row",{staticClass:"justify-content-center my-3"},t._l(t.loadedTables,function(e){return n("b-col",{key:e.id,attrs:{cols:"6",sm:"4",md:"2"}},[n("b-card",{staticClass:"available-table",attrs:{"img-src":"/images/svg/models/model_"+e.svg_id+".svg","img-alt":"Image","img-top":""},on:{click:function(n){return t.addTable(e)}}},[n("b-card-text",{staticClass:"text-center"},[t._v(t._s(e.name))])],1)],1)}),1),t._v(" "),n("b-row",{staticClass:"justify-content-center my-3"},[n("b-col",{attrs:{cols:"10"},on:{click:function(e){return t.clickOnTablesPlan(e)}}},[n("svg-vue",{attrs:{id:"tables_plan",icon:"models/model_plan"}})],1)],1),t._v(" "),n("b-row",{staticClass:"justify-content-center my-2"},[n("b-button",{attrs:{size:"sm",variant:"danger",disabled:!t.selectedTable},on:{click:t.deleteTable}},[t._v("Supprimer la table sélectionnée")])],1),t._v(" "),n("b-row",{staticClass:"justify-content-center my-2"},[n("b-button",{attrs:{variant:"primary",disabled:!t.newPerformance.date||t.loading},on:{click:t.savePlan}},[t._v("Créer le plan")]),n("br")],1)],1)},[],!1,null,"823cf536",null);e.default=b.exports},246:function(t,e){(function(){function t(t){t.remember("_draggable",this),this.el=t}t.prototype.init=function(t,e){var n=this;this.constraint=t,this.value=e,this.el.on("mousedown.drag",function(t){n.start(t)}),this.el.on("touchstart.drag",function(t){n.start(t)})},t.prototype.transformPoint=function(t,e){var n=(t=t||window.event).changedTouches&&t.changedTouches[0]||t;return this.p.x=n.clientX-(e||0),this.p.y=n.clientY,this.p.matrixTransform(this.m)},t.prototype.getBBox=function(){var t=this.el.bbox();return this.el instanceof SVG.Nested&&(t=this.el.rbox()),(this.el instanceof SVG.G||this.el instanceof SVG.Use||this.el instanceof SVG.Nested)&&(t.x=this.el.x(),t.y=this.el.y()),t},t.prototype.start=function(t){if("click"!=t.type&&"mousedown"!=t.type&&"mousemove"!=t.type||1==(t.which||t.buttons)){var e=this;if(this.el.fire("beforedrag",{event:t,handler:this}),!this.el.event().defaultPrevented){t.preventDefault(),t.stopPropagation(),this.parent=this.parent||this.el.parent(SVG.Nested)||this.el.parent(SVG.Doc),this.p=this.parent.node.createSVGPoint(),this.m=this.el.node.getScreenCTM().inverse();var n,a=this.getBBox();if(this.el instanceof SVG.Text)switch(n=this.el.node.getComputedTextLength(),this.el.attr("text-anchor")){case"middle":n/=2;break;case"start":n=0}this.startPoints={point:this.transformPoint(t,n),box:a,transform:this.el.transform()},SVG.on(window,"mousemove.drag",function(t){e.drag(t)}),SVG.on(window,"touchmove.drag",function(t){e.drag(t)}),SVG.on(window,"mouseup.drag",function(t){e.end(t)}),SVG.on(window,"touchend.drag",function(t){e.end(t)}),this.el.fire("dragstart",{event:t,p:this.startPoints.point,m:this.m,handler:this})}}},t.prototype.drag=function(t){var e=this.getBBox(),n=this.transformPoint(t),a=this.startPoints.box.x+n.x-this.startPoints.point.x,r=this.startPoints.box.y+n.y-this.startPoints.point.y,o=this.constraint,s=n.x-this.startPoints.point.x,i=n.y-this.startPoints.point.y;if(this.el.fire("dragmove",{event:t,p:n,m:this.m,handler:this}),this.el.event().defaultPrevented)return n;if("function"==typeof o){var l=o.call(this.el,a,r,this.m);"boolean"==typeof l&&(l={x:l,y:l}),!0===l.x?this.el.x(a):!1!==l.x&&this.el.x(l.x),!0===l.y?this.el.y(r):!1!==l.y&&this.el.y(l.y)}else"object"==typeof o&&(null!=o.minX&&a<o.minX?s=(a=o.minX)-this.startPoints.box.x:null!=o.maxX&&a>o.maxX-e.width&&(s=(a=o.maxX-e.width)-this.startPoints.box.x),null!=o.minY&&r<o.minY?i=(r=o.minY)-this.startPoints.box.y:null!=o.maxY&&r>o.maxY-e.height&&(i=(r=o.maxY-e.height)-this.startPoints.box.y),null!=o.snapToGrid&&(a-=a%o.snapToGrid,r-=r%o.snapToGrid,s-=s%o.snapToGrid,i-=i%o.snapToGrid),this.el instanceof SVG.G?this.el.matrix(this.startPoints.transform).transform({x:s,y:i},!0):this.el.move(a,r));return n},t.prototype.end=function(t){var e=this.drag(t);this.el.fire("dragend",{event:t,p:e,m:this.m,handler:this}),SVG.off(window,"mousemove.drag"),SVG.off(window,"touchmove.drag"),SVG.off(window,"mouseup.drag"),SVG.off(window,"touchend.drag")},SVG.extend(SVG.Element,{draggable:function(e,n){"function"!=typeof e&&"object"!=typeof e||(n=e,e=!0);var a=this.remember("_draggable")||new t(this);return(e=void 0===e||e)?a.init(n||{},e):(this.off("mousedown.drag"),this.off("touchstart.drag")),this}})}).call(this)},287:function(t,e,n){"use strict";var a=n(48);n.n(a).a},288:function(t,e,n){(t.exports=n(6)(!1)).push([t.i,"\n[data-v-823cf536] .table:hover {\n\tcursor: -webkit-grab;\n\tcursor: grab;\n\tfill: var(--primary);\n}\n[data-v-823cf536] .table:active {\n\tcursor: -webkit-grabbing;\n\tcursor: grabbing;\n}\n.available-table[data-v-823cf536] {\n\tfont-size: 0.8rem;\n}\n.available-table[data-v-823cf536]:hover {\n\tcursor: pointer;\n\tbackground: var(--primary);\n}\n.disabled[data-v-823cf536]:hover {\n\tcursor: not-allowed;\n}\n.inset[data-v-823cf536] {\n\tpadding: 10px;\n\tbackground-color: #dcdcdc;\n\tborder: 1px solid var(--primary);\n\tborder-radius: 10px;\n}\n#tables_plan[data-v-823cf536] {\n\tborder: 2px solid var(--primary);\n}\n",""])},48:function(t,e,n){var a=n(288);"string"==typeof a&&(a=[[t.i,a,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};n(7)(a,r);a.locals&&(t.exports=a.locals)}}]);