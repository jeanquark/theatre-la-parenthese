(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{17:function(e,t,n){"use strict";var a,r=n(0),s=n.n(r),o=(n(3),n(5)),l=n.n(o);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function c(e,t,n,a,r,s,o){try{var l=e[s](o),i=l.value}catch(e){return void n(e)}l.done?t(i):Promise.resolve(i).then(a,r)}function d(e){return function(){var t=this,n=arguments;return new Promise(function(a,r){var s=e.apply(t,n);function o(e){c(s,a,r,o,l,"next",e)}function l(e){c(s,a,r,o,l,"throw",e)}o(void 0)})}}var u=(i(a={props:["selectedTable"],created:{}},"created",function(){var e=d(s.a.mark(function e(){return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()),i(a,"mounted",function(){var e=this;console.log("Modal mounted() lifecycle hook called"),this.$root.$on("bv::modal::shown",function(t,n){l.a.supported&&e.loadedPlan&&e.selectedTable&&e.loadedPlan.plan_seats.filter(function(t){return t.plan_table_id===e.selectedTable.id}).forEach(function(e){var t=e.svg_id.substring(e.svg_id.lastIndexOf("_")+1),n=l.a.get("".concat(t,"_group")),a=l.a.get("".concat(t,"_path")),r=l.a.get("".concat(t,"_text"));r&&r.plain(e.seat_number),a&&e.is_reserved&&(a.fill("#FF0000"),n.removeClass("seat"))})})}),i(a,"data",function(){return{selectedSeat:"",seatReserved:!1,reservationConfirmationCountdown:parseInt("30")}}),i(a,"computed",{loadedPlans:function(){return this.$store.getters["plans/plans"]},loadedPlan:function(){return this.$store.getters["plans/plans"][parseInt(this.$route.params.id)]},loadedUser:function(){return this.$store.getters["auth/user"]},loadedPlanSeats:function(){return this.$store.getters["planSeats/planSeats"]},loadedTableSeats:function(){return this.loadedPlan?this.loadedPlan.plan_seats.reduce(function(e,t){return e[t.plan_table_id]||(e[t.plan_table_id]=[]),e[t.plan_table_id].push(t),e},{})[this.selectedTable.id]:{}}}),i(a,"methods",{selectSeat:function(){var e=d(s.a.mark(function e(t){var n,a,r,o,i,c,d=this;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,console.log("selectSeat: ",t),n=t.target.id,a=n.substring(0,n.indexOf("_")),r=this.selectedTable.id,o=this.selectedTable.svg_id,i=l.a.get("".concat(a,"_group")),c=!1,i&&(c=i.hasClass("seat")),!c){e.next=16;break}return e.next=12,this.$store.dispatch("planSeats/updatePlanSeats",{planTableId:r,tableSvgId:o,seatSvgId:a});case 12:this.seatReserved=!0,this.$noty.success("La place a été ajoutée à votre panier!"),this.$store.commit("countdown/SET_COUNTDOWN",!1),setTimeout(function(){d.$store.commit("countdown/SET_COUNTDOWN",!0)},1e3);case 16:e.next=22;break;case 18:e.prev=18,e.t0=e.catch(0),console.log("error from Modal component: ",e.t0),e.t0.response&&409===e.t0.response.status?this.$noty.error("Nous sommes désolés, mais ce siège est déjà réservé."):e.t0.response&&401===e.t0.response.status?(this.$noty.warning("Veuillez vous connecter avant de réserver une place."),this.unauthenticated=!0,this.$router.push({name:"login",query:{redirect:"/reservations/".concat(this.$route.params.id)}})):this.$noty.error("Nous sommes désolés, une erreur est survenue et le siège n'a pas pu être réservé");case 22:case"end":return e.stop()}},e,this,[[0,18]])}));return function(t){return e.apply(this,arguments)}}()}),i(a,"watch",{loadedPlan:function(){console.log("[WATCHER] loadedPlan watcher called from modal!"),l.a.supported&&this.loadedPlan.plan_seats.forEach(function(e){var t=e.svg_id.substring(e.svg_id.lastIndexOf("_")+1),n=l.a.get("".concat(t,"_group"));n&&e.is_reserved&&(n.fill("#FF0000"),n.removeClass("seat"))})}}),a),p=(n(276),n(2)),f=Object(p.a)(u,function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("b-modal",{attrs:{id:"seat-modal","hide-footer":""},scopedSlots:e._u([e.selectedTable?{key:"modal-title",fn:function(){return[e._v("Réservez vos places:\n        "),n("span",{staticClass:"primary-color"},[e._v("Table "+e._s(e.selectedTable.table_number))])]},proxy:!0}:null],null,!0)},[e._v(" "),e.seatReserved?n("b-row",{staticClass:"justify-content-center"},[n("router-link",{attrs:{to:"/mon-panier"}},[e._v("Voir mon panier →")])],1):e._e(),e._v(" "),e.selectedTable?n("div",{attrs:{id:"drawing"},on:{click:function(t){return e.selectSeat(t)}}},[n("svg-vue",{attrs:{icon:"models/model_"+e.selectedTable.svg_model}})],1):e._e(),e._v(" "),n("div",[n("p",[e._v("\n            En "),n("span",{staticStyle:{color:"red"}},[n("b",[e._v("rouge")])]),e._v(": siège occupé. En "),n("b",[e._v("noir")]),e._v(": siège libre.\n        ")])]),e._v(" "),n("b-button",{staticClass:"mt-3",attrs:{block:""},on:{click:function(t){return e.$bvModal.hide("seat-modal")}}},[e._v("Fermer")])],1)},[],!1,null,"09d869de",null);t.a=f.exports},24:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),s=n(1),o=n.n(s);function l(e,t,n,a,r,s,o){try{var l=e[s](o),i=l.value}catch(e){return void n(e)}l.done?t(i):Promise.resolve(i).then(a,r)}function i(e){return function(){var t=this,n=arguments;return new Promise(function(a,r){var s=e.apply(t,n);function o(e){l(s,a,r,o,i,"next",e)}function i(e){l(s,a,r,o,i,"throw",e)}o(void 0)})}}var c={components:{Modal:n(17).a},layout:"frontend",created:function(){var e=i(r.a.mark(function e(){return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}(),mounted:function(){var e=i(r.a.mark(function e(){var t,n,a,s,l,i,c,d,u,p,f,v,h,m,b,_,g,x,y,P;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,t=parseInt(this.$route.params.id),console.log("performanceId: ",t),this.$store.getters["performances/performances"][t]){e.next=6;break}return e.next=6,this.$store.dispatch("performances/fetchPerformanceById",{performanceId:t});case 6:return e.next=8,this.$store.dispatch("plans/fetchPlanById",{planId:t});case 8:if(!SVG.supported){e.next=73;break}n=!0,a=!1,s=void 0,e.prev=12,l=this.planTables[Symbol.iterator]();case 14:if(n=(i=l.next()).done){e.next=59;break}c=i.value,d=c.svg_id,u=c.total_seats,p=0,f=!0,v=!1,h=void 0,e.prev=22,m=this.tableSeats[c.id][Symbol.iterator]();case 24:if(f=(b=m.next()).done){e.next=42;break}if("pre_reservation"!==(_=b.value).status){e.next=36;break}if(console.log("DELETE_PAST_PRE_RESERVATIONS"),g=o()(_.updated_at),x=o()().format("YYYY-MM-DD HH:mm:ss"),y=Math.abs(g.diff(x)/1e3),console.log("elapsed_time: ",y),21600,!(y>21600)){e.next=36;break}return e.next=36,this.$store.dispatch("planSeats/deletePlanSeatPreReservation",{planSeatId:_.id});case 36:P=SVG.get("".concat(d,"_group")),_.is_reserved&&(p+=1),P&&(u-p<=2&&P.fill("#FFA500"),u-p<1&&(P.fill("#FF0000"),P.removeClass("table")));case 39:f=!0,e.next=24;break;case 42:e.next=48;break;case 44:e.prev=44,e.t0=e.catch(22),v=!0,h=e.t0;case 48:e.prev=48,e.prev=49,f||null==m.return||m.return();case 51:if(e.prev=51,!v){e.next=54;break}throw h;case 54:return e.finish(51);case 55:return e.finish(48);case 56:n=!0,e.next=14;break;case 59:e.next=65;break;case 61:e.prev=61,e.t1=e.catch(12),a=!0,s=e.t1;case 65:e.prev=65,e.prev=66,n||null==l.return||l.return();case 68:if(e.prev=68,!a){e.next=71;break}throw s;case 71:return e.finish(68);case 72:return e.finish(65);case 73:this.listenToBroadcastedEvents(),e.next=80;break;case 76:e.prev=76,e.t2=e.catch(0),console.log("error: ",e.t2),this.$noty.error("Nous sommes désolés. Le plan de salle n'a pas pu être récupéré. Veuillez contacter le webmaster si le problème persiste.");case 80:case"end":return e.stop()}},e,this,[[0,76],[12,61,65,73],[22,44,48,56],[49,,51,55],[66,,68,72]])}));return function(){return e.apply(this,arguments)}}(),data:function(){return{showModal:!1,selectedPlan:{},selectedTable:{},svgFile:null,reservationConfirmationCountdown:parseInt("30")}},computed:{loadedPerformances:function(){return this.$store.getters["performances/performances"]},loadedPerformance:function(){return this.$store.getters["performances/performances"][parseInt(this.$route.params.id)]},loadedPlans:function(){return this.$store.getters["plans/plans"]},loadedPlan:function(){return this.$store.getters["plans/plans"][parseInt(this.$route.params.id)]},planTables:function(){return this.loadedPlan.plan_tables},loadedPlanSeats:function(){return this.$store.getters["planSeats/planSeats"]},tableSeats:function(){return this.loadedPlan?this.loadedPlan.plan_seats.reduce(function(e,t){return e[t.plan_table_id]||(e[t.plan_table_id]=[]),e[t.plan_table_id].push(t),e},{}):{}}},methods:{listenToBroadcastedEvents:function(){var e=this;this.$echo.channel("update-table-seat").listen("UpdateTableSeat",function(t){console.log("{EVENT BROADCAST] update table seat channel: ",t);var n=t.updatedSeat;e.$store.commit("plans/UPDATE_PLAN",n,{root:!0})})},clickOnTablePlan:function(){var e=i(r.a.mark(function e(t){var n,a,s;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:try{console.log("clickOnTablePlan: ",t),n=t.target.id,a=n.substring(0,n.indexOf("_")),(s=SVG.get("".concat(a,"_group")))&&s.hasClass("table")?(this.selectedTable=this.loadedPlan.plan_tables.find(function(e){return e.svg_id===a}),this.showModal=!0,this.$bvModal.show("seat-modal")):this.selectedTable=null}catch(e){console.log("error: ",e),this.$noty.error("Une erreur est survenue. Veuillez nous excuser.")}case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),updateTableColor:function(e){console.log("updateTableColor: ",e);var t=e.table_svg_id,n=e.color;SVG.get(t).fill(n)}},watch:{loadedPlan:function(){if(console.log("[WATCHER] loadedPlan watcher called from reservation page!"),SVG.supported){var e=!0,t=!1,n=void 0;try{for(var a,r=this.planTables[Symbol.iterator]();!(e=(a=r.next()).done);e=!0){var s=a.value;console.log("table: ",s);var o=s.svg_id,l=s.total_seats,i=0,c=!0,d=!1,u=void 0;try{for(var p,f=this.tableSeats[s.id][Symbol.iterator]();!(c=(p=f.next()).done);c=!0){var v=p.value;console.log("seat: ",v);var h=SVG.get("".concat(o,"_group"));console.log("tableElement from [WATCH] loadedPlan reservations/_id/index: ",h),v.is_reserved&&(i+=1),h&&(l-i<=2&&h.fill("#FFA500"),l-i<1&&(h.fill("#FF0000"),h.removeClass("table")))}}catch(e){d=!0,u=e}finally{try{c||null==f.return||f.return()}finally{if(d)throw u}}}}catch(e){t=!0,n=e}finally{try{e||null==r.return||r.return()}finally{if(t)throw n}}}}}},d=(n(332),n(2)),u=Object(d.a)(c,function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("b-container",[n("b-row",{staticClass:"justify-content-center"},[n("b-col",{attrs:{cols:"12"}},[n("h3",{staticClass:"text-center"},[e._v("Représentation du ")]),e._v(" "),e.loadedPerformance?n("h3",{staticClass:"text-center"},[e._v(e._s(e._f("moment")(e.loadedPerformance.date,"dddd Do MMMM YYYY [à] HH:mm")))]):e._e()])],1),e._v(" "),n("b-row",{staticClass:"justify-content-center"},[e.loadedPlan?n("b-col",{staticClass:"my-5",attrs:{cols:"12",md:"8"},on:{click:function(t){return e.clickOnTablePlan(t)}}},[n("div",{ref:"svgFile",staticClass:"primary-border",domProps:{innerHTML:e._s(e.loadedPlan.svg_plan)}})]):e._e(),e._v(" "),e.loadedPlan?n("modal",{attrs:{selectedTable:e.selectedTable},on:{updateTableColor:e.updateTableColor}}):e._e()],1)],1)},[],!1,null,"2497e06c",null);t.default=u.exports},276:function(e,t,n){"use strict";var a=n(38);n.n(a).a},277:function(e,t,n){(e.exports=n(6)(!1)).push([e.i,".primary-color[data-v-09d869de] {\n  color: #9ACD32;\n}\n[data-v-09d869de] .seat:hover {\n  cursor: pointer;\n  fill: #9ACD32;\n}",""])},332:function(e,t,n){"use strict";var a=n(66);n.n(a).a},333:function(e,t,n){(e.exports=n(6)(!1)).push([e.i,"[data-v-2497e06c] .table:hover {\n  cursor: pointer;\n  fill: #9ACD32;\n}\n.primary-border[data-v-2497e06c] {\n  border: 2px solid #9ACD32;\n}",""])},38:function(e,t,n){var a=n(277);"string"==typeof a&&(a=[[e.i,a,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};n(7)(a,r);a.locals&&(e.exports=a.locals)},66:function(e,t,n){var a=n(333);"string"==typeof a&&(a=[[e.i,a,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};n(7)(a,r);a.locals&&(e.exports=a.locals)}}]);