(window.webpackJsonp=window.webpackJsonp||[]).push([[19],{120:function(e,t,a){"use strict";a.r(t);var s=a(0),r=a.n(s),n=a(8),o=a.n(n),l=a(5),i=a.n(l),c=(a(257),a(71)),d=a(11),b=a.n(d);a(16);function u(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function m(e,t,a,s,r,n,o){try{var l=e[n](o),i=l.value}catch(e){return void a(e)}l.done?t(i):Promise.resolve(i).then(s,r)}function h(e){return function(){var t=this,a=arguments;return new Promise(function(s,r){var n=e.apply(t,a);function o(e){m(n,s,r,o,l,"next",e)}function l(e){m(n,s,r,o,l,"throw",e)}o(void 0)})}}var f={components:{TableDetailsModal:c.a,VueCtkDateTimePicker:b.a},created:function(){var e=h(r.a.mark(function e(){return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.$store.getters["tables/tables"].length){e.next=3;break}return e.next=3,this.$store.dispatch("tables/fetchTables");case 3:return e.next=5,this.$store.dispatch("shows/fetchShows");case 5:return e.next=7,this.$store.dispatch("performances/fetchPerformances");case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),mounted:function(){},data:function(){return{form:new o.a({name:"",svg_id:""}),selectedShow:null,selectedTable:null,newTablesArray:[],newTablesSVGArray:[],newPerformance:{show_id:"",name:"",location:"",date:""},newTable:{}}},computed:{loading:function(){return this.$store.getters["loading/loading"]},loadedTables:function(){return this.$store.getters["tables/tables"]},loadedShows:function(){return this.$store.getters["shows/shows"]}},methods:{updateShowId:function(){var e=Math.random().toString(36).substr(2,9);this.form.svg_id=e,this.newPerformance.show_id=this.selectedShow.id},formattedTableNumber:function(e){return("0"+e).slice(-2)},clickOnTablesPlan:function(){var e=h(r.a.mark(function e(t){var a,s;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:try{a=t.target.id,s=a.substring(0,a.indexOf("_")),this.selectedTable&&this.selectedTable.svg_id&&i.a.get("".concat(this.selectedTable.svg_id,"_table")).attr("stroke",null),"tables_plan"!=a?(this.selectedTable=this.newTablesArray.find(function(e){return e.svg_id===s}),i.a.get("".concat(s,"_table")).attr("stroke","#FF0000").attr("stroke-width",1)):(console.log("Click on blank space"),this.selectedTable=null)}catch(e){console.log("error: ",e)}case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),openTableDetailsModal:function(e){var t=this;this.newTable=function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{},s=Object.keys(a);"function"==typeof Object.getOwnPropertySymbols&&(s=s.concat(Object.getOwnPropertySymbols(a).filter(function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable}))),s.forEach(function(t){u(e,t,a[t])})}return e}({},e,{seats:[]});for(var a=0;a<e.total_seats;a++)this.newTable.seats.push({seat_number:this.formattedTableNumber(a+1),price:3e3});var s="01",r=i()("tables_plan").svg().match(/data-table-number="\d+"/g),n=[];r&&(r.forEach(function(e){return n.push(parseInt(e.match(/\d+/g)[0]))}),console.log("array: ",n),s=n.reduce(function(e,a){return e>a?t.formattedTableNumber(parseInt(e)+1):t.formattedTableNumber(parseInt(a)+1)},s)),this.newTable.table_number=s,this.$bvModal.show("table-details")},addTable:function(){var e=h(r.a.mark(function e(){var t,a,s;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:console.log("addTable"),t=Math.random().toString(36).substr(2,9),this.newTable.svg_id=t,this.newTable.plan_id=parseInt(this.$route.params.id),this.newTablesArray.push(this.newTable),a=this.newTable.r/2,"circle"===this.newTable.svg_type&&((s=i()("tables_plan").group().attr({id:"".concat(t,"_group")}).draggable({minX:-(i()("tables_plan").viewbox().width/2-a),maxX:i()("tables_plan").viewbox().width/2+a,minY:-(i()("tables_plan").viewbox().height/2-a),maxY:i()("tables_plan").viewbox().height/2+a}).addClass("table")).circle(this.newTable.r).attr({cx:i()("tables_plan").viewbox().width/2,cy:i()("tables_plan").viewbox().height/2,id:"".concat(t,"_table"),"data-svg-model":this.newTable.svg_model,"data-total-seats":this.newTable.total_seats,"data-table-number":this.newTable.table_number}),s.text("").attr({id:"".concat(t,"_text")}).tspan(this.newTable.table_number).attr({id:"".concat(t,"_span")}).font({family:"Helvetica",size:10,dx:i()("tables_plan").viewbox().width/2-6,dy:i()("tables_plan").viewbox().height/2+3,fill:"#9ACD32"})),"path"==this.newTable.svg_type&&i()("tables_plan").path(this.newTable.d).attr({id:t,"data-svg-model":this.newTable.svg_model,"data-total-seats":this.newTable.total_seats}).draggable().addClass("table");case 8:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),createPlan:function(){var e=h(r.a.mark(function e(){return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,this.$store.commit("loading/SET_LOADING",!0),this.selectedTable&&this.selectedTable.svg_id&&i.a.get("".concat(this.selectedTable.svg_id,"_table")).attr("stroke",null),this.form.newPlanSVG=i()("tables_plan").svg(),this.form.newPerformance=this.newPerformance,this.form.newTablesArray=this.newTablesArray,console.log("form: ",this.form),e.next=9,this.$store.dispatch("plans/createPlan",this.form);case 9:this.$store.commit("loading/SET_LOADING",!1),this.$noty.success("Le plan de salle a été créé avec succès. Vous allez être redirigé vers la page des plans."),setTimeout(function(){window.location.href="../plans"},1e3),e.next=19;break;case 14:e.prev=14,e.t0=e.catch(0),console.log("error: ",e.t0),this.$store.commit("loading/SET_LOADING",!1),this.$noty.error("Une erreur est apparue et le plan de salle n'a pas pu être créé.");case 19:case"end":return e.stop()}},e,this,[[0,14]])}));return function(){return e.apply(this,arguments)}}(),deleteTable:function(){var e=h(r.a.mark(function e(){var t=this;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:try{this.newTablesArray=this.newTablesArray.filter(function(e){return e.svg_id!==t.selectedTable.svg_id}),i.a.get("".concat(this.selectedTable.svg_id,"_group")).remove(),this.selectedTable=null}catch(e){this.$noty.error("Nous sommes désolés. Une erreur est survenue et la table n'a pas pu être supprimée.")}case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()}},p=(a(316),a(2)),v=Object(p.a)(f,function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("b-container",[a("b-breadcrumb",[a("b-breadcrumb-item",{staticClass:"navigation",attrs:{to:"/admin/plans"}},[a("font-awesome-icon",{attrs:{icon:"chair"}}),e._v(" "),a("span",[e._v("Plans de salle")])],1),e._v(" "),a("b-breadcrumb-item",{attrs:{active:""}},[e._v("Créer")])],1),e._v(" "),a("h2",{staticClass:"text-center"},[e._v("Créer un nouveau plan")]),e._v(" "),a("b-row",{staticClass:"justify-content-center my-3 px-3"},[a("b-col",{attrs:{cols:"12",md:"6"}},[a("b-form-group",{attrs:{label:"Nom:","label-for":"name"}},[a("b-form-input",{class:{"is-invalid":e.form.errors.has("name")},attrs:{id:"name",name:"name",placeholder:"Nom de la page"},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}}),e._v(" "),a("has-error",{attrs:{form:e.form,field:"name"}})],1)],1),e._v(" "),a("b-col",{attrs:{cols:"12",md:"6"}},[a("b-form-group",{attrs:{label:"Sélectionner le spectacle:","label-for":"newPlanShow"}},[a("b-form-select",{class:{"is-invalid":e.form.errors.has("newPerformance.show_id")},attrs:{id:"newPlanShow",name:"newPerformance.show_id"},on:{change:e.updateShowId},model:{value:e.selectedShow,callback:function(t){e.selectedShow=t},expression:"selectedShow"}},e._l(e.loadedShows,function(t){return a("option",{key:t.id,domProps:{value:t}},[e._v(e._s(t.name))])}),0),e._v(" "),e.form.errors&&e.form.errors.errors&&e.form.errors.errors["newPerformance.show_id"]?a("div",{staticClass:"help-block invalid-feedback"},[e._v("Veuillez séléctionner un spectacle")]):e._e()],1)],1)],1),e._v(" "),e.selectedShow?a("b-row",{staticClass:"justify-content-start my-3 px-3"},[a("b-col",{attrs:{cols:"12",md:"6"}},[a("b-form-group",{attrs:{label:"Entrer un nom pour cette représentation:",name:"newPerformance.name","label-for":"newPerformanceName"}},[a("b-form-input",{class:{"is-invalid":e.form.errors.has("newPerformance.name")},attrs:{id:"newPerformanceName",placeholder:"Représentation n°1"},model:{value:e.newPerformance.name,callback:function(t){e.$set(e.newPerformance,"name",t)},expression:"newPerformance.name"}}),e._v(" "),e.form.errors&&e.form.errors.errors&&e.form.errors.errors["newPerformance.name"]?a("div",{staticClass:"help-block invalid-feedback"},[e._v("Le nom de la représentation est obligatoire")]):e._e()],1)],1),e._v(" "),a("b-col",{attrs:{cols:"12",md:"6"}},[a("b-form-group",{attrs:{label:"Entrer un lieu pour cette représentation:","label-for":"newPerformanceLocation"}},[a("b-form-input",{attrs:{id:"newPerformanceLocation",placeholder:"Beaulieu, Morges"},model:{value:e.newPerformance.location,callback:function(t){e.$set(e.newPerformance,"location",t)},expression:"newPerformance.location"}})],1)],1),e._v(" "),a("b-col",{attrs:{cols:"12",md:"6"}},[a("b-form-group",{attrs:{label:"Entrer une date pour cette représentation:","label-for":"newPerformanceDate"}},[a("VueCtkDateTimePicker",{attrs:{label:"Cliquer pour choisir une date",format:"YYYY-MM-DD HH:mm",formatted:"YYYY-MM-DD HH:mm",color:"#9ACD32","button-color":"#9ACD32","button-now-translation":"Aujourd'hui",id:"newPerformanceDate"},model:{value:e.newPerformance.date,callback:function(t){e.$set(e.newPerformance,"date",t)},expression:"newPerformance.date"}})],1)],1)],1):e._e(),e._v(" "),a("b-row",{staticClass:"justify-content-center my-3"},e._l(e.loadedTables,function(t){return a("b-col",{key:t.id,attrs:{cols:"6",sm:"4",md:"2"}},[a("b-card",{staticClass:"available-table",attrs:{"img-src":"/images/svg/models/model_"+t.svg_id+".svg","img-alt":"Image","img-top":""},on:{click:function(a){return e.openTableDetailsModal(t)}}},[a("b-card-text",{staticClass:"text-center"},[e._v(e._s(t.name))])],1)],1)}),1),e._v(" "),a("b-row",{staticClass:"justify-content-center my-3"},[a("b-col",{attrs:{cols:"10"},on:{click:function(t){return e.clickOnTablesPlan(t)}}},[a("svg-vue",{attrs:{id:"tables_plan",icon:"models/model_plan"}})],1),e._v(" "),a("b-col",{staticClass:"my-4",attrs:{cols:"8",md:"8"}},[e.selectedTable?a("div",[a("h4",{staticClass:"text-center"},[e._v("Table sélectionnée: "+e._s(e.selectedTable.table_number))])]):e._e(),e._v(" "),a("b-row",{staticClass:"justify-content-center"},[a("b-col",{attrs:{cols:"12",sm:"6",md:"4"}},[a("svg-vue",{directives:[{name:"show",rawName:"v-show",value:e.selectedTable&&"table_round_4_seats"===e.selectedTable.svg_model,expression:"selectedTable && selectedTable.svg_model === 'table_round_4_seats'"}],attrs:{id:"model_table_round_4_seats",icon:"models/model_table_round_4_seats"}}),e._v(" "),a("svg-vue",{directives:[{name:"show",rawName:"v-show",value:e.selectedTable&&"table_round_6_seats"===e.selectedTable.svg_model,expression:"selectedTable && selectedTable.svg_model === 'table_round_6_seats'"}],attrs:{id:"model_table_round_6_seats",icon:"models/model_table_round_6_seats"}}),e._v(" "),a("svg-vue",{directives:[{name:"show",rawName:"v-show",value:e.selectedTable&&"table_round_8_seats"===e.selectedTable.svg_model,expression:"selectedTable && selectedTable.svg_model === 'table_round_8_seats'"}],attrs:{id:"model_table_round_8_seats",icon:"models/model_table_round_8_seats"}})],1),e._v(" "),e.selectedTable?a("b-col",{attrs:{cols:"12",sm:"6",md:"4","align-self":"center"}},[e._v("\n                    En "),a("b",[e._v("noir")]),e._v(": siège libre, en "),a("span",{staticStyle:{color:"#ff0000"}},[a("b",[e._v("rouge")])]),e._v(": siège réservé."),a("br"),e._v(" "),a("ul",e._l(e.selectedTable.seats,function(t,s){return a("li",{key:s},[e._v("Place n°"+e._s(t.seat_number)+", prix: "+e._s(t.price))])}),0)]):e._e()],1)],1)],1),e._v(" "),a("b-row",{staticClass:"justify-content-center my-2"},[a("b-button",{attrs:{size:"sm",variant:"danger",disabled:!e.selectedTable},on:{click:e.deleteTable}},[e._v("Supprimer la table sélectionnée")])],1),e._v(" "),a("b-row",{staticClass:"justify-content-center my-2"},[a("b-button",{attrs:{variant:"primary",disabled:e.loading},on:{click:e.createPlan}},[e.loading?a("b-spinner",{attrs:{small:"",type:"grow"}}):e._e(),e._v("\n            Créer le plan")],1),a("br")],1),e._v(" "),a("b-row",{staticClass:"justify-content-center"},[a("b-alert",{attrs:{variant:"danger",dismissible:"",show:e.form.errors.any()}},[e._v("Erreur lors de l'envoi. Veuillez vérifier la validité des champs.")])],1),e._v(" "),a("table-details-modal",{attrs:{newTable:e.newTable},on:{addTable:e.addTable}})],1)},[],!1,null,"a4a1eaa2",null);t.default=v.exports},257:function(e,t){(function(){function e(e){e.remember("_draggable",this),this.el=e}e.prototype.init=function(e,t){var a=this;this.constraint=e,this.value=t,this.el.on("mousedown.drag",function(e){a.start(e)}),this.el.on("touchstart.drag",function(e){a.start(e)})},e.prototype.transformPoint=function(e,t){var a=(e=e||window.event).changedTouches&&e.changedTouches[0]||e;return this.p.x=a.clientX-(t||0),this.p.y=a.clientY,this.p.matrixTransform(this.m)},e.prototype.getBBox=function(){var e=this.el.bbox();return this.el instanceof SVG.Nested&&(e=this.el.rbox()),(this.el instanceof SVG.G||this.el instanceof SVG.Use||this.el instanceof SVG.Nested)&&(e.x=this.el.x(),e.y=this.el.y()),e},e.prototype.start=function(e){if("click"!=e.type&&"mousedown"!=e.type&&"mousemove"!=e.type||1==(e.which||e.buttons)){var t=this;if(this.el.fire("beforedrag",{event:e,handler:this}),!this.el.event().defaultPrevented){e.preventDefault(),e.stopPropagation(),this.parent=this.parent||this.el.parent(SVG.Nested)||this.el.parent(SVG.Doc),this.p=this.parent.node.createSVGPoint(),this.m=this.el.node.getScreenCTM().inverse();var a,s=this.getBBox();if(this.el instanceof SVG.Text)switch(a=this.el.node.getComputedTextLength(),this.el.attr("text-anchor")){case"middle":a/=2;break;case"start":a=0}this.startPoints={point:this.transformPoint(e,a),box:s,transform:this.el.transform()},SVG.on(window,"mousemove.drag",function(e){t.drag(e)}),SVG.on(window,"touchmove.drag",function(e){t.drag(e)}),SVG.on(window,"mouseup.drag",function(e){t.end(e)}),SVG.on(window,"touchend.drag",function(e){t.end(e)}),this.el.fire("dragstart",{event:e,p:this.startPoints.point,m:this.m,handler:this})}}},e.prototype.drag=function(e){var t=this.getBBox(),a=this.transformPoint(e),s=this.startPoints.box.x+a.x-this.startPoints.point.x,r=this.startPoints.box.y+a.y-this.startPoints.point.y,n=this.constraint,o=a.x-this.startPoints.point.x,l=a.y-this.startPoints.point.y;if(this.el.fire("dragmove",{event:e,p:a,m:this.m,handler:this}),this.el.event().defaultPrevented)return a;if("function"==typeof n){var i=n.call(this.el,s,r,this.m);"boolean"==typeof i&&(i={x:i,y:i}),!0===i.x?this.el.x(s):!1!==i.x&&this.el.x(i.x),!0===i.y?this.el.y(r):!1!==i.y&&this.el.y(i.y)}else"object"==typeof n&&(null!=n.minX&&s<n.minX?o=(s=n.minX)-this.startPoints.box.x:null!=n.maxX&&s>n.maxX-t.width&&(o=(s=n.maxX-t.width)-this.startPoints.box.x),null!=n.minY&&r<n.minY?l=(r=n.minY)-this.startPoints.box.y:null!=n.maxY&&r>n.maxY-t.height&&(l=(r=n.maxY-t.height)-this.startPoints.box.y),null!=n.snapToGrid&&(s-=s%n.snapToGrid,r-=r%n.snapToGrid,o-=o%n.snapToGrid,l-=l%n.snapToGrid),this.el instanceof SVG.G?this.el.matrix(this.startPoints.transform).transform({x:o,y:l},!0):this.el.move(s,r));return a},e.prototype.end=function(e){var t=this.drag(e);this.el.fire("dragend",{event:e,p:t,m:this.m,handler:this}),SVG.off(window,"mousemove.drag"),SVG.off(window,"touchmove.drag"),SVG.off(window,"mouseup.drag"),SVG.off(window,"touchend.drag")},SVG.extend(SVG.Element,{draggable:function(t,a){"function"!=typeof t&&"object"!=typeof t||(a=t,t=!0);var s=this.remember("_draggable")||new e(this);return(t=void 0===t||t)?s.init(a||{},t):(this.off("mousedown.drag"),this.off("touchstart.drag")),this}})}).call(this)},316:function(e,t,a){"use strict";var s=a(58);a.n(s).a},317:function(e,t,a){(e.exports=a(6)(!1)).push([e.i,"[data-v-a4a1eaa2] .table:hover {\n  cursor: -webkit-grab;\n  cursor: grab;\n  fill: #9ACD32;\n}\n[data-v-a4a1eaa2] .table:active {\n  cursor: -webkit-grabbing;\n  cursor: grabbing;\n}\n.available-table[data-v-a4a1eaa2] {\n  font-size: 0.8rem;\n}\n.available-table[data-v-a4a1eaa2]:hover {\n  cursor: pointer;\n  background: #9ACD32;\n}\n.disabled[data-v-a4a1eaa2]:hover {\n  cursor: not-allowed;\n}\n.inset[data-v-a4a1eaa2] {\n  padding: 10px;\n  background-color: #dcdcdc;\n  border: 1px solid #9ACD32;\n  border-radius: 10px;\n}\n#tables_plan[data-v-a4a1eaa2] {\n  border: 2px solid #9ACD32;\n}",""])},58:function(e,t,a){var s=a(317);"string"==typeof s&&(s=[[e.i,s,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};a(7)(s,r);s.locals&&(e.exports=s.locals)},71:function(e,t,a){"use strict";var s={props:["newTable"],data:function(){return{}}},r=a(2),n=Object(r.a)(s,function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("b-modal",{ref:"modal",attrs:{size:"lg",id:"table-details",title:"Détails de la nouvelle table"},on:{ok:function(t){return e.$emit("addTable")}}},[a("b-row",{attrs:{"no-gutters":""}},[a("b-col",{staticClass:"px-3",attrs:{cols:"12",md:"6"}},[a("b-form-group",{attrs:{label:"Numéro de table","label-for":"table-number-input","invalid-feedback":"Name is required"}},[a("b-form-input",{attrs:{id:"table-number-input",required:""},model:{value:e.newTable.table_number,callback:function(t){e.$set(e.newTable,"table_number",t)},expression:"newTable.table_number"}})],1)],1),e._v(" "),a("b-col",{staticClass:"px-3",attrs:{cols:"12",md:"6"}},[a("b-form-group",{attrs:{label:"Nombre de sièges"}},[a("b-form-input",{attrs:{readonly:""},model:{value:e.newTable.total_seats,callback:function(t){e.$set(e.newTable,"total_seats",t)},expression:"newTable.total_seats"}})],1)],1)],1),e._v(" "),a("b-row",{attrs:{"no-gutters":""}},e._l(e.newTable.seats,function(t,s){return a("b-col",{key:s,staticClass:"px-3",attrs:{cols:"12",md:"6"}},[a("b-row",{attrs:{"no-gutters":"","align-v":"center"}},[a("b-col",{staticClass:"px-1",attrs:{cols:"6"}},[a("b-form-group",{attrs:{label:"N° siège "+(s+1),description:(e.newTable.seats[s].price/100).toFixed(2)+" CHF","label-for":""}},[a("b-form-input",{attrs:{id:""},model:{value:e.newTable.seats[s].seat_number,callback:function(t){e.$set(e.newTable.seats[s],"seat_number",t)},expression:"newTable.seats[index]['seat_number']"}})],1)],1),e._v(" "),a("b-col",{staticClass:"px-1",attrs:{cols:"6"}},[a("b-form-group",{attrs:{label:"Prix siège "+(s+1)+" (centimes)","label-for":"",description:"= "+(e.newTable.seats[s].price/100).toFixed(2)+" CHF"}},[a("b-form-input",{attrs:{id:"",type:"number",required:""},model:{value:e.newTable.seats[s].price,callback:function(t){e.$set(e.newTable.seats[s],"price",t)},expression:"newTable.seats[index]['price']"}})],1)],1)],1)],1)}),1)],1)},[],!1,null,"b3a452fc",null);t.a=n.exports}}]);