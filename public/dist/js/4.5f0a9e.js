(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{29:function(n,t,e){"use strict";e.r(t);var s=e(0),a=e.n(s);function r(n,t,e,s,a,r,i){try{var o=n[r](i),l=o.value}catch(n){return void e(n)}o.done?t(l):Promise.resolve(l).then(s,a)}function i(n){return function(){var t=this,e=arguments;return new Promise(function(s,a){var i=n.apply(t,e);function o(n){r(i,s,a,o,l,"next",n)}function l(n){r(i,s,a,o,l,"throw",n)}o(void 0)})}}var o={layout:"backend",created:function(){var n=i(a.a.mark(function n(){return a.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(!(Object.entries(this.$store.getters["plans/plans"]).length<=1)){n.next=6;break}return this.$store.commit("loading/SET_LOADING",!0),console.log("fetchPlans"),n.next=5,this.$store.dispatch("plans/fetchPlans");case 5:this.$store.commit("loading/SET_LOADING",!1);case 6:case"end":return n.stop()}},n,this)}));return function(){return n.apply(this,arguments)}}(),mounted:function(){},data:function(){return{arr:[],sortBy:"id",sortDesc:!0,fields:[{key:"id",sortable:!0},{key:"name",label:"Nom",sortable:!0},{key:"performance.show.name",label:"Spectacle",sortable:!0},{key:"performance.date",label:"Date",sortable:!0},{key:"filling_rate",label:"Taux de remplissage",sortable:!0},{key:"show_details",label:"Détails",sortable:!1},{key:"actions",sortable:!1}]}},computed:{loading:function(){return this.$store.getters["loading/loading"]},plans:function(){return this.$store.getters["plans/plans"]},plansArray:function(){var n=[];for(var t in this.plans)this.plans.hasOwnProperty(t)&&null!=this.plans[t]&&n.push(this.plans[t]);return n}},methods:{computeFillingRate:function(n){return n.length>0?n.filter(function(n){return n.is_reserved}).length/n.length*100:0},deletePlan:function(){var n=i(a.a.mark(function n(t){var e;return a.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,this.$bvModal.msgBoxConfirm("Etes-vous sûr de vouloir supprimer le plan ".concat(t," et toutes les tables et les sièges qui lui sont attribués?"),{okTitle:"OK",cancelTitle:"Annuler"});case 3:if(e=n.sent,console.log("value: ",e),!e){n.next=9;break}return n.next=8,this.$store.dispatch("plans/deletePlan",{planId:t});case 8:this.$noty.success("Plan de salle supprimé avec succès!");case 9:n.next=15;break;case 11:n.prev=11,n.t0=n.catch(0),console.log("error: ",n.t0),this.$noty.error("Une erreur est survenue et le plan de salle n'a pas pu être supprimé.");case 15:case"end":return n.stop()}},n,this,[[0,11]])}));return function(t){return n.apply(this,arguments)}}()}},l=(e(320),e(322),e(2)),c=Object(l.a)(o,function(){var n=this,t=n.$createElement,e=n._self._c||t;return e("b-container",[e("b-breadcrumb",[e("b-breadcrumb-item",{attrs:{active:""}},[e("font-awesome-icon",{attrs:{icon:"chair"}}),n._v(" Plans de salle")],1)],1),n._v(" "),e("h2",{staticClass:"text-center mb-3"},[n._v("Plans de salle")]),n._v(" "),e("b-button",{staticClass:"my-3",attrs:{to:"/admin/plans/create",variant:"primary"}},[n._v("Créer un nouveau plan")]),n._v(" "),n.loading?n._e():e("b-table",{staticClass:"nowrap",attrs:{responsive:"sm",items:n.plansArray,fields:n.fields,"sort-by":n.sortBy,"sort-desc":n.sortDesc},on:{"update:sortBy":function(t){n.sortBy=t},"update:sort-by":function(t){n.sortBy=t},"update:sortDesc":function(t){n.sortDesc=t},"update:sort-desc":function(t){n.sortDesc=t}},scopedSlots:n._u([{key:"cell(performance.date)",fn:function(t){return[n._v("\n\t\t\t\t"+n._s(n._f("moment")(t.item.performance.date,"DD MMM YYYY"))+"\n\t\t\t")]}},{key:"cell(filling_rate)",fn:function(t){return[e("b-progress",{attrs:{value:n.computeFillingRate(t.item.plan_seats),max:100,"show-value":"",variant:"success"}})]}},{key:"cell(show_details)",fn:function(t){return[e("b-button",{staticClass:"mr-2",attrs:{size:"sm"},on:{click:t.toggleDetails}},[n._v("\n\t\t\t\t\t"+n._s(t.detailsShowing?"Cacher":"Montrer")+" détails\n\t\t\t\t")])]}},{key:"cell(actions)",fn:function(t){return[e("router-link",{staticClass:"btn btn-warning",staticStyle:{display:"inline-block"},attrs:{to:"/admin/plans/"+t.item.id}},[e("font-awesome-icon",{attrs:{icon:"eye"}})],1),n._v(" "),e("router-link",{staticClass:"btn btn-success",staticStyle:{display:"inline-block"},attrs:{to:"/admin/plans/"+t.item.id+"/edit"}},[e("font-awesome-icon",{attrs:{icon:"edit"}})],1),n._v(" "),e("button",{staticClass:"btn btn-danger",on:{click:function(e){return n.deletePlan(t.item.id)}}},[e("font-awesome-icon",{attrs:{icon:"trash"}})],1)]}},{key:"row-details",fn:function(t){return[e("b-card",[e("b-row",{staticClass:"mb-2"},[e("b-col",{staticClass:"text-sm-right",attrs:{sm:"3"}},[e("b",[n._v("Spectacle:")])]),n._v(" "),e("b-col",[n._v(n._s(t.item.performance.show.name))])],1),n._v(" "),e("b-row",{staticClass:"mb-2"},[e("b-col",{staticClass:"text-sm-right",attrs:{sm:"3"}},[e("b",[n._v("Représentation:")])]),n._v(" "),e("b-col",[n._v(n._s(t.item.performance.name))])],1),n._v(" "),e("b-row",{staticClass:"mb-2"},[e("b-col",{staticClass:"text-sm-right",attrs:{sm:"3"}},[e("b",[n._v("Date:")])]),n._v(" "),e("b-col",[n._v(n._s(n._f("moment")(t.item.performance.date,"dddd Do MMM YYYY HH:mm")))])],1),n._v(" "),e("b-row",{staticClass:"mb-2"},[e("b-col",{staticClass:"text-sm-right",attrs:{sm:"3"}},[e("b",[n._v("Nb. tables:")])]),n._v(" "),e("b-col",[n._v(n._s(t.item.plan_tables.length))])],1),n._v(" "),e("b-row",{staticClass:"mb-2"},[e("b-col",{staticClass:"text-sm-right",attrs:{sm:"3"}},[e("b",[n._v("Nb. places:")])]),n._v(" "),e("b-col",[n._v(n._s(t.item.plan_seats.length))])],1),n._v(" "),e("b-row",{staticClass:"mb-2"},[e("b-col",{staticClass:"text-sm-right",attrs:{sm:"3"}},[e("b",[n._v("Slug:")])]),n._v(" "),e("b-col",[n._v(n._s(t.item.slug))])],1),n._v(" "),e("b-row",{staticClass:"mb-2"},[e("b-col",{staticClass:"text-sm-right",attrs:{sm:"3"}},[e("b",[n._v("SVG id:")])]),n._v(" "),e("b-col",[n._v(n._s(t.item.svg_id))])],1),n._v(" "),e("b-row",{staticClass:"mb-2"},[e("b-col",{staticClass:"text-sm-right",attrs:{sm:"3"}},[e("b",[n._v("Dernière modification:")])]),n._v(" "),e("b-col",[n._v(n._s(n._f("moment")(t.item.updated_at,"from","now")))])],1),n._v(" "),e("b-row",{staticClass:"justify-content-center mb-2"},[e("b-button",{attrs:{size:"sm"},on:{click:t.toggleDetails}},[n._v("Cacher détails")])],1)],1)]}}],null,!1,4032501825)}),n._v(" "),n.loading?e("b-row",{staticClass:"justify-content-center"},[e("b-spinner",{attrs:{variant:"primary",label:"Spinning"}})],1):n._e()],1)},[],!1,null,"1360df6d",null);t.default=c.exports},320:function(n,t,e){"use strict";var s=e(60);e.n(s).a},321:function(n,t,e){(n.exports=e(6)(!1)).push([n.i,"\n.table.b-table > thead > tr > [aria-sort][data-v-1360df6d]:not(.b-table-sort-icon-left) {\n\t\tvertical-align: middle;\n}\n.inline-block[data-v-1360df6d] {\n\t\tdisplay: inline-block;\n}\n.nowrap[data-v-1360df6d] {\n        white-space:nowrap;\n}\n\t/*>>>.table.b-table > thead > tr > th {*/\n\t/*.table th {\n\t\tvertical-align: middle;\n\t}\n\t>>>.table td {\n\t\tvertical-align: middle;\n\t}*/\n",""])},322:function(n,t,e){"use strict";var s=e(61);e.n(s).a},323:function(n,t,e){(n.exports=e(6)(!1)).push([n.i,"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n/*.table.b-table > thead > tr > th {\n\tvertical-align: middle;\n}*/\n",""])},60:function(n,t,e){var s=e(321);"string"==typeof s&&(s=[[n.i,s,""]]);var a={hmr:!0,transform:void 0,insertInto:void 0};e(7)(s,a);s.locals&&(n.exports=s.locals)},61:function(n,t,e){var s=e(323);"string"==typeof s&&(s=[[n.i,s,""]]);var a={hmr:!0,transform:void 0,insertInto:void 0};e(7)(s,a);s.locals&&(n.exports=s.locals)}}]);