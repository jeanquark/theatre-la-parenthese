(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{16:function(e,t,n){"use strict";var a,r=n(0),s=n.n(r),o=(n(3),n(4)),l=n.n(o);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function c(e,t,n,a,r,s,o){try{var l=e[s](o),i=l.value}catch(e){return void n(e)}l.done?t(i):Promise.resolve(i).then(a,r)}function u(e){return function(){var t=this,n=arguments;return new Promise(function(a,r){var s=e.apply(t,n);function o(e){c(s,a,r,o,l,"next",e)}function l(e){c(s,a,r,o,l,"throw",e)}o(void 0)})}}var d=(i(a={props:["selectedTable"],created:{}},"created",function(){var e=u(s.a.mark(function e(){return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()),i(a,"mounted",function(){var e=this;console.log("Modal mounted() lifecycle hook called"),this.$root.$on("bv::modal::shown",function(t,n){l.a.supported&&e.loadedPlan&&e.selectedTable&&e.loadedPlan.plan_seats.filter(function(t){return t.plan_table_id===e.selectedTable.id}).forEach(function(e){var t=e.svg_id.substring(e.svg_id.lastIndexOf("_")+1),n=l.a.get("".concat(t,"_group")),a=l.a.get("".concat(t,"_path")),r=l.a.get("".concat(t,"_text"));r&&r.plain(e.seat_number),a&&e.is_reserved&&(a.fill("#FF0000"),n.removeClass("seat"))})})}),i(a,"data",function(){return{selectedSeat:"",seatReserved:!1,reservationConfirmationCountdown:parseInt("30")}}),i(a,"computed",{loadedPlans:function(){return this.$store.getters["plans/plans"]},loadedPlan:function(){return this.$store.getters["plans/plans"][parseInt(this.$route.params.id)]},loadedUser:function(){return this.$store.getters["auth/user"]},loadedPlanSeats:function(){return this.$store.getters["planSeats/planSeats"]},loadedTableSeats:function(){return this.loadedPlan?this.loadedPlan.plan_seats.reduce(function(e,t){return e[t.plan_table_id]||(e[t.plan_table_id]=[]),e[t.plan_table_id].push(t),e},{})[this.selectedTable.id]:{}}}),i(a,"methods",{selectSeat:function(){var e=u(s.a.mark(function e(t){var n,a,r,o,i,c,u=this;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,console.log("selectSeat: ",t),n=t.target.id,a=n.substring(0,n.indexOf("_")),r=this.selectedTable.id,o=this.selectedTable.svg_id,i=l.a.get("".concat(a,"_group")),c=!1,i&&(c=i.hasClass("seat")),!c){e.next=16;break}return e.next=12,this.$store.dispatch("planSeats/updatePlanSeats",{planTableId:r,tableSvgId:o,seatSvgId:a});case 12:this.seatReserved=!0,this.$noty.success("La place a été ajoutée à votre panier!"),this.$store.commit("countdown/SET_COUNTDOWN",!1),setTimeout(function(){u.$store.commit("countdown/SET_COUNTDOWN",!0)},1e3);case 16:e.next=22;break;case 18:e.prev=18,e.t0=e.catch(0),console.log("error from Modal component: ",e.t0),e.t0.response&&409===e.t0.response.status?this.$noty.error("Nous sommes désolés, mais ce siège est déjà réservé."):e.t0.response&&401===e.t0.response.status?(this.$noty.warning("Veuillez vous connecter avant de réserver une place."),this.unauthenticated=!0,this.$router.push({name:"login",query:{redirect:"/reservations/".concat(this.$route.params.id)}})):this.$noty.error("Nous sommes désolés, une erreur est survenue et le siège n'a pas pu être réservé");case 22:case"end":return e.stop()}},e,this,[[0,18]])}));return function(t){return e.apply(this,arguments)}}()}),i(a,"watch",{loadedPlan:function(){console.log("[WATCHER] loadedPlan watcher called from modal!"),l.a.supported&&this.loadedPlan.plan_seats.forEach(function(e){var t=e.svg_id.substring(e.svg_id.lastIndexOf("_")+1),n=l.a.get("".concat(t,"_group"));n&&e.is_reserved&&(n.fill("#FF0000"),n.removeClass("seat"))})}}),a),p=(n(263),n(2)),f=Object(p.a)(d,function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("b-modal",{attrs:{id:"seat-modal","hide-footer":""},scopedSlots:e._u([e.selectedTable?{key:"modal-title",fn:function(){return[e._v("Réservez vos places:\n        "),n("span",{staticClass:"primary-color"},[e._v("Table "+e._s(e.selectedTable.table_number))])]},proxy:!0}:null],null,!0)},[e._v(" "),e.seatReserved?n("b-row",{staticClass:"justify-content-center"},[n("router-link",{attrs:{to:"/mon-panier"}},[e._v("Voir mon panier →")])],1):e._e(),e._v(" "),e.selectedTable?n("div",{attrs:{id:"drawing"},on:{click:function(t){return e.selectSeat(t)}}},[n("svg-vue",{attrs:{icon:"models/model_"+e.selectedTable.svg_model}})],1):e._e(),e._v(" "),n("div",[n("p",[e._v("\n            En "),n("span",{staticStyle:{color:"red"}},[n("b",[e._v("rouge")])]),e._v(": siège occupé. En "),n("b",[e._v("noir")]),e._v(": siège libre.\n        ")])]),e._v(" "),n("b-button",{staticClass:"mt-3",attrs:{block:""},on:{click:function(t){return e.$bvModal.hide("seat-modal")}}},[e._v("Fermer")])],1)},[],!1,null,"09d869de",null);t.a=f.exports},25:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a);function s(e,t,n,a,r,s,o){try{var l=e[s](o),i=l.value}catch(e){return void n(e)}l.done?t(i):Promise.resolve(i).then(a,r)}function o(e){return function(){var t=this,n=arguments;return new Promise(function(a,r){var o=e.apply(t,n);function l(e){s(o,a,r,l,i,"next",e)}function i(e){s(o,a,r,l,i,"throw",e)}l(void 0)})}}var l={components:{Modal:n(16).a},layout:"frontend",created:function(){var e=o(r.a.mark(function e(){return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}(),mounted:function(){var e=o(r.a.mark(function e(){var t,n,a,s,o,l,i,c,u,d,p,f,v,h,b,m,_;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,t=parseInt(this.$route.params.id),console.log("performanceId: ",t),this.$store.getters["performances/performances"][t]){e.next=6;break}return e.next=6,this.$store.dispatch("performances/fetchPerformanceById",{performanceId:t});case 6:return e.next=8,this.$store.dispatch("plans/fetchPlanById",{planId:t});case 8:if(!SVG.supported){e.next=55;break}n=!0,a=!1,s=void 0,e.prev=12,o=this.planTables[Symbol.iterator]();case 14:if(n=(l=o.next()).done){e.next=41;break}for(i=l.value,c=i.svg_id,u=i.total_seats,d=0,p=!0,f=!1,v=void 0,e.prev=22,h=this.tableSeats[i.id][Symbol.iterator]();!(p=(b=h.next()).done);p=!0)m=b.value,_=SVG.get("".concat(c,"_group")),m.is_reserved&&(d+=1),_&&(u-d<=2&&_.fill("#FFA500"),u-d<1&&(_.fill("#FF0000"),_.removeClass("table")));e.next=30;break;case 26:e.prev=26,e.t0=e.catch(22),f=!0,v=e.t0;case 30:e.prev=30,e.prev=31,p||null==h.return||h.return();case 33:if(e.prev=33,!f){e.next=36;break}throw v;case 36:return e.finish(33);case 37:return e.finish(30);case 38:n=!0,e.next=14;break;case 41:e.next=47;break;case 43:e.prev=43,e.t1=e.catch(12),a=!0,s=e.t1;case 47:e.prev=47,e.prev=48,n||null==o.return||o.return();case 50:if(e.prev=50,!a){e.next=53;break}throw s;case 53:return e.finish(50);case 54:return e.finish(47);case 55:this.listenToBroadcastedEvents(),e.next=62;break;case 58:e.prev=58,e.t2=e.catch(0),console.log("error: ",e.t2),this.$noty.error("Nous sommes désolés. Le plan de salle n'a pas pu être récupéré. Veuillez contacter le webmaster si le problème persiste.");case 62:case"end":return e.stop()}},e,this,[[0,58],[12,43,47,55],[22,26,30,38],[31,,33,37],[48,,50,54]])}));return function(){return e.apply(this,arguments)}}(),data:function(){return{showModal:!1,selectedPlan:{},selectedTable:{},svgFile:null,reservationConfirmationCountdown:parseInt("30")}},computed:{loadedPerformances:function(){return this.$store.getters["performances/performances"]},loadedPerformance:function(){return this.$store.getters["performances/performances"][parseInt(this.$route.params.id)]},loadedPlans:function(){return this.$store.getters["plans/plans"]},loadedPlan:function(){return this.$store.getters["plans/plans"][parseInt(this.$route.params.id)]},planTables:function(){return this.loadedPlan.plan_tables},loadedPlanSeats:function(){return this.$store.getters["planSeats/planSeats"]},tableSeats:function(){return this.loadedPlan?this.loadedPlan.plan_seats.reduce(function(e,t){return e[t.plan_table_id]||(e[t.plan_table_id]=[]),e[t.plan_table_id].push(t),e},{}):{}}},methods:{listenToBroadcastedEvents:function(){var e=this;this.$echo.channel("update-table-seat").listen("UpdateTableSeat",function(t){console.log("{EVENT BROADCAST] update table seat channel: ",t);var n=t.updatedSeat;e.$store.commit("plans/UPDATE_PLAN",n,{root:!0})})},clickOnTablePlan:function(){var e=o(r.a.mark(function e(t){var n,a,s;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:try{console.log("clickOnTablePlan: ",t),n=t.target.id,console.log("tableId: ",n),a=n.substring(0,n.indexOf("_")),console.log("tableSvgId: ",a),s=SVG.get("".concat(a,"_group")),console.log("element: ",s),console.log("element.hasClass('table'): ",s.hasClass("table")),s&&s.hasClass("table")?(this.selectedTable=this.loadedPlan.plan_tables.find(function(e){return e.svg_id===a}),this.showModal=!0,this.$bvModal.show("seat-modal")):this.selectedTable=null}catch(e){console.log("error: ",e),this.$noty.error("Une erreur est survenue. Veuillez nous excuser.")}case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),updateTableColor:function(e){console.log("updateTableColor: ",e);var t=e.table_svg_id,n=e.color;SVG.get(t).fill(n)}},watch:{loadedPlan:function(){if(console.log("[WATCHER] loadedPlan watcher called from reservation page!"),SVG.supported){var e=!0,t=!1,n=void 0;try{for(var a,r=this.planTables[Symbol.iterator]();!(e=(a=r.next()).done);e=!0){var s=a.value;console.log("table: ",s);var o=s.svg_id,l=s.total_seats,i=0,c=!0,u=!1,d=void 0;try{for(var p,f=this.tableSeats[s.id][Symbol.iterator]();!(c=(p=f.next()).done);c=!0){var v=p.value;console.log("seat: ",v);var h=SVG.get("".concat(o,"_group"));console.log("tableElement from [WATCH] loadedPlan reservations/_id/index: ",h),v.is_reserved&&(i+=1),h&&(l-i<=2&&h.fill("#FFA500"),l-i<1&&(h.fill("#FF0000"),h.removeClass("table")))}}catch(e){u=!0,d=e}finally{try{c||null==f.return||f.return()}finally{if(u)throw d}}}}catch(e){t=!0,n=e}finally{try{e||null==r.return||r.return()}finally{if(t)throw n}}}}}},i=(n(303),n(2)),c=Object(i.a)(l,function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("b-container",[n("b-row",{staticClass:"justify-content-center"},[n("b-col",{attrs:{cols:"12"}},[n("h3",{staticClass:"text-center"},[e._v("Représentation du ")]),e._v(" "),e.loadedPerformance?n("h3",{staticClass:"text-center"},[e._v(e._s(e._f("moment")(e.loadedPerformance.date,"dddd Do MMMM YYYY [à] HH:mm")))]):e._e()])],1),e._v(" "),n("b-row",{staticClass:"justify-content-center"},[e.loadedPlan?n("b-col",{staticClass:"my-5",attrs:{cols:"12",md:"8"},on:{click:function(t){return e.clickOnTablePlan(t)}}},[n("div",{ref:"svgFile",staticClass:"primary-border",domProps:{innerHTML:e._s(e.loadedPlan.svg_plan)}})]):e._e(),e._v(" "),e.loadedPlan?n("modal",{attrs:{selectedTable:e.selectedTable},on:{updateTableColor:e.updateTableColor}}):e._e()],1)],1)},[],!1,null,"17eb9afa",null);t.default=c.exports},263:function(e,t,n){"use strict";var a=n(36);n.n(a).a},264:function(e,t,n){(e.exports=n(6)(!1)).push([e.i,".primary-color[data-v-09d869de] {\n  color: #9ACD32;\n}\n[data-v-09d869de] .seat:hover {\n  cursor: pointer;\n  fill: #9ACD32;\n}",""])},303:function(e,t,n){"use strict";var a=n(56);n.n(a).a},304:function(e,t,n){(e.exports=n(6)(!1)).push([e.i,"[data-v-17eb9afa] .table:hover {\n  cursor: pointer;\n  fill: #9ACD32;\n}\n.primary-border[data-v-17eb9afa] {\n  border: 2px solid #9ACD32;\n}",""])},36:function(e,t,n){var a=n(264);"string"==typeof a&&(a=[[e.i,a,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};n(7)(a,r);a.locals&&(e.exports=a.locals)},56:function(e,t,n){var a=n(304);"string"==typeof a&&(a=[[e.i,a,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};n(7)(a,r);a.locals&&(e.exports=a.locals)}}]);