(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{16:function(e,t,a){"use strict";var r,n=a(0),o=a.n(n),s=(a(3),a(4)),l=a.n(s);function i(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function c(e,t,a,r,n,o,s){try{var l=e[o](s),i=l.value}catch(e){return void a(e)}l.done?t(i):Promise.resolve(i).then(r,n)}function d(e){return function(){var t=this,a=arguments;return new Promise(function(r,n){var o=e.apply(t,a);function s(e){c(o,r,n,s,l,"next",e)}function l(e){c(o,r,n,s,l,"throw",e)}s(void 0)})}}var u=(i(r={props:["selectedTable"],created:{}},"created",function(){var e=d(o.a.mark(function e(){return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()),i(r,"mounted",function(){var e=this;console.log("Modal mounted() lifecycle hook called"),this.$root.$on("bv::modal::shown",function(t,a){console.log("Modal is about to be shown",t,a),l.a.supported&&e.loadedPlan&&e.selectedTable&&(console.log("SVG.supported: ",l.a.supported),e.loadedPlan.plan_seats.filter(function(t){return t.plan_table_id===e.selectedTable.id}).forEach(function(e){console.log("seat: ",e);var t=e.svg_id.substring(e.svg_id.lastIndexOf("_")+1),a=l.a.get("".concat(t,"_group")),r=l.a.get("".concat(t,"_path"));console.log("seatElement from modal: ",r);var n=l.a.get("".concat(t,"_text"));console.log("textElement from modal: ",n),n&&n.plain(e.seat_number),r&&e.is_reserved&&(r.fill("#FF0000"),a.removeClass("seat"))}))})}),i(r,"data",function(){return{selectedSeat:"",seatReserved:!1}}),i(r,"computed",{loadedPlans:function(){return this.$store.getters["plans/plans"]},loadedPlan:function(){return this.$store.getters["plans/plans"][parseInt(this.$route.params.id)]},loadedUser:function(){return this.$store.getters["auth/user"]},loadedPlanSeats:function(){return this.$store.getters["planSeats/planSeats"]},loadedTableSeats:function(){return this.loadedPlan?this.loadedPlan.plan_seats.reduce(function(e,t){return e[t.plan_table_id]||(e[t.plan_table_id]=[]),e[t.plan_table_id].push(t),e},{})[this.selectedTable.id]:{}}}),i(r,"methods",{selectSeat:function(){var e=d(o.a.mark(function e(t){var a,r,n,s,i,c;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,console.log("selectSeat: ",t),this.loadedUser){e.next=5;break}return this.$noty.warning("Veuillez vous connecter afin de pouvoir effectuer une réservation."),e.abrupt("return");case 5:if(a=t.target.id,console.log("seat: ",a),r=a.substring(0,a.indexOf("_")),console.log("seatSvgId: ",r),n=this.selectedTable.id,console.log("planTableId: ",n),s=this.selectedTable.svg_id,console.log("tableSvgId: ",s),i=l.a.get("".concat(r,"_group")),console.log("element: ",i),c=!1,i&&(c=i.hasClass("seat")),!c){e.next=22;break}return e.next=20,this.$store.dispatch("planSeats/updatePlanSeats",{planTableId:n,tableSvgId:s,seatSvgId:r});case 20:this.seatReserved=!0,this.$noty.success("La place a été ajoutée à votre panier!");case 22:e.next=28;break;case 24:e.prev=24,e.t0=e.catch(0),console.log("error from Modal component: ",e.t0),e.t0.response&&409===e.t0.response.status?this.$noty.error("Nous sommes désolés, mais ce siège est déjà réservé."):e.t0.response&&401===e.t0.response.status?(this.$noty.warning("Veuillez vous connecter avant de réserver une place."),this.unauthenticated=!0,this.$router.push({name:"login",query:{redirect:"/reservations/".concat(this.$route.params.id)}})):this.$noty.error("Nous sommes désolés, une erreur est survenue et le siège n'a pas pu être réservé");case 28:case"end":return e.stop()}},e,this,[[0,24]])}));return function(t){return e.apply(this,arguments)}}()}),i(r,"watch",{loadedPlan:function(){console.log("[WATCHER] loadedPlan watcher called from modal!"),l.a.supported&&this.loadedPlan.plan_seats.forEach(function(e){var t=e.svg_id.substring(e.svg_id.lastIndexOf("_")+1),a=l.a.get("".concat(t,"_group"));console.log("element2: ",a),a&&e.is_reserved&&(a.fill("#FF0000"),a.removeClass("seat"))})}}),r),p=(a(260),a(2)),v=Object(p.a)(u,function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("b-modal",{attrs:{id:"seat-modal","hide-footer":""},scopedSlots:e._u([{key:"modal-title",fn:function(){return[e._v("Réservez vos places: \n        "),a("span",{staticClass:"primary-color"},[e._v("Table "+e._s(e.selectedTable.table_number))])]},proxy:!0}])},[e._v(" "),e.loadedUser?e._e():a("b-alert",{attrs:{show:"",variant:"warning"}},[e._v("Il faut être connecté pour effectuer une reservation. "),a("router-link",{attrs:{to:"/login?redirect=reservations/"+this.$route.params.id}},[e._v("Se connecter")]),e._v(".")],1),e._v(" "),e.seatReserved?a("b-row",{staticClass:"justify-content-center"},[a("router-link",{attrs:{to:"/mon-panier"}},[e._v("Voir mon panier →")])],1):e._e(),e._v(" "),e.selectedTable?a("div",{attrs:{id:"drawing"},on:{click:function(t){return e.selectSeat(t)}}},[a("svg-vue",{attrs:{icon:"models/model_"+e.selectedTable.svg_model}})],1):e._e(),e._v(" "),a("div",[a("p",[e._v("\n            En "),a("span",{staticStyle:{color:"red"}},[a("b",[e._v("rouge")])]),e._v(": siège occupé. En "),a("b",[e._v("noir")]),e._v(": siège libre.\n        ")])]),e._v(" "),a("b-button",{staticClass:"mt-3",attrs:{block:""},on:{click:function(t){return e.$bvModal.hide("seat-modal")}}},[e._v("Fermer")])],1)},[],!1,null,"35a1c0de",null);t.a=v.exports},260:function(e,t,a){"use strict";var r=a(35);a.n(r).a},261:function(e,t,a){(e.exports=a(6)(!1)).push([e.i,".primary-color[data-v-35a1c0de] {\n  color: #9ACD32;\n}\n[data-v-35a1c0de] .seat:hover {\n  cursor: pointer;\n  fill: #9ACD32;\n}",""])},30:function(e,t,a){"use strict";a.r(t);var r=a(0),n=a.n(r);function o(e,t,a,r,n,o,s){try{var l=e[o](s),i=l.value}catch(e){return void a(e)}l.done?t(i):Promise.resolve(i).then(r,n)}function s(e){return function(){var t=this,a=arguments;return new Promise(function(r,n){var s=e.apply(t,a);function l(e){o(s,r,n,l,i,"next",e)}function i(e){o(s,r,n,l,i,"throw",e)}l(void 0)})}}var l={components:{Modal:a(16).a},layout:"frontend",created:function(){var e=s(n.a.mark(function e(){return n.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}(),mounted:function(){var e=s(n.a.mark(function e(){var t,a,r,o,s,l,i,c,d,u,p,v,f,h,b,m,_;return n.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,t=parseInt(this.$route.params.id),console.log("performanceId: ",t),this.$store.getters["performances/performances"][t]){e.next=6;break}return e.next=6,this.$store.dispatch("performances/fetchPerformanceById",{performanceId:t});case 6:return e.next=8,this.$store.dispatch("plans/fetchPlanById",{planId:t});case 8:if(!SVG.supported){e.next=56;break}a=!0,r=!1,o=void 0,e.prev=12,s=this.planTables[Symbol.iterator]();case 14:if(a=(l=s.next()).done){e.next=42;break}for(i=l.value,console.log("table: ",i),c=i.svg_id,d=i.total_seats,u=0,p=!0,v=!1,f=void 0,e.prev=23,h=this.tableSeats[i.id][Symbol.iterator]();!(p=(b=h.next()).done);p=!0)m=b.value,console.log("seat: ",m),_=SVG.get("".concat(c,"_group")),console.log("tableElement from reservations/_id/index: ",_),m.is_reserved&&(u+=1),_&&(d-u<=2&&_.fill("#FFA500"),d-u<1&&(_.fill("#FF0000"),_.removeClass("table")));e.next=31;break;case 27:e.prev=27,e.t0=e.catch(23),v=!0,f=e.t0;case 31:e.prev=31,e.prev=32,p||null==h.return||h.return();case 34:if(e.prev=34,!v){e.next=37;break}throw f;case 37:return e.finish(34);case 38:return e.finish(31);case 39:a=!0,e.next=14;break;case 42:e.next=48;break;case 44:e.prev=44,e.t1=e.catch(12),r=!0,o=e.t1;case 48:e.prev=48,e.prev=49,a||null==s.return||s.return();case 51:if(e.prev=51,!r){e.next=54;break}throw o;case 54:return e.finish(51);case 55:return e.finish(48);case 56:this.listenToBroadcastedEvents(),e.next=63;break;case 59:e.prev=59,e.t2=e.catch(0),console.log("error: ",e.t2),this.$noty.error("Une erreur est survenue sur cette page. Si l'erreur persiste, veuillez contacter le webmaster.");case 63:case"end":return e.stop()}},e,this,[[0,59],[12,44,48,56],[23,27,31,39],[32,,34,38],[49,,51,55]])}));return function(){return e.apply(this,arguments)}}(),data:function(){return{showModal:!1,selectedPlan:{},selectedTable:{},svgFile:null}},computed:{loadedPerformances:function(){return this.$store.getters["performances/performances"]},loadedPerformance:function(){return this.$store.getters["performances/performances"][parseInt(this.$route.params.id)]},loadedPlans:function(){return this.$store.getters["plans/plans"]},loadedPlan:function(){return this.$store.getters["plans/plans"][parseInt(this.$route.params.id)]},planTables:function(){return this.loadedPlan.plan_tables},loadedPlanSeats:function(){return this.$store.getters["planSeats/planSeats"]},tableSeats:function(){return this.loadedPlan?this.loadedPlan.plan_seats.reduce(function(e,t){return e[t.plan_table_id]||(e[t.plan_table_id]=[]),e[t.plan_table_id].push(t),e},{}):{}}},methods:{listenToBroadcastedEvents:function(){var e=this;this.$echo.channel("update-table-seat").listen("UpdateTableSeat",function(t){console.log("{EVENT BROADCAST] update table seat channel: ",t);var a=t.updatedSeat;e.$store.commit("plans/UPDATE_PLAN",a,{root:!0})})},clickOnTablePlan:function(){var e=s(n.a.mark(function e(t){var a,r,o;return n.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:try{console.log("clickOnTablePlan: ",t),a=t.target.id,r=a.substring(0,a.indexOf("_")),(o=SVG.get("".concat(r,"_group")))&&o.hasClass("table")?(this.selectedTable=this.loadedPlan.plan_tables.find(function(e){return e.svg_id===r}),this.showModal=!0,this.$bvModal.show("seat-modal")):this.selectedTable=null}catch(e){console.log("error: ",e),this.$noty.error("Une erreur est survenue. Veuillez nous excuser.")}case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),updateTableColor:function(e){console.log("updateTableColor: ",e);var t=e.table_svg_id,a=e.color;SVG.get(t).fill(a)}},watch:{loadedPlan:function(){if(console.log("[WATCHER] loadedPlan watcher called from reservation page!"),SVG.supported){var e=!0,t=!1,a=void 0;try{for(var r,n=this.planTables[Symbol.iterator]();!(e=(r=n.next()).done);e=!0){var o=r.value;console.log("table: ",o);var s=o.svg_id,l=o.total_seats,i=0,c=!0,d=!1,u=void 0;try{for(var p,v=this.tableSeats[o.id][Symbol.iterator]();!(c=(p=v.next()).done);c=!0){var f=p.value;console.log("seat: ",f);var h=SVG.get("".concat(s,"_group"));console.log("tableElement from [WATCH] loadedPlan reservations/_id/index: ",h),f.is_reserved&&(i+=1),h&&(l-i<=2&&h.fill("#FFA500"),l-i<1&&(h.fill("#FF0000"),h.removeClass("table")))}}catch(e){d=!0,u=e}finally{try{c||null==v.return||v.return()}finally{if(d)throw u}}}}catch(e){t=!0,a=e}finally{try{e||null==n.return||n.return()}finally{if(t)throw a}}}},loadedPlan3:function(){if(console.log("[WATCHER] loadedPlan watcher called from reservation page!"),SVG.supported){var e=0;for(var t in this.tableSeats){var a=0,r=this.loadedPlan.plan_tables[e].total_seats,n=this.loadedPlan.plan_tables[e].svg_id;console.log("tableSvgId: ",n);var o=!0,s=!1,l=void 0;try{for(var i,c=this.tableSeats[t][Symbol.iterator]();!(o=(i=c.next()).done);o=!0){var d=i.value,u=SVG.get("".concat(n,"_group"));console.log("tableElement: ",u),d.is_reserved&&(a+=1),u&&(r-a<=2&&u.fill("#FFA500"),r-a<1&&(u.fill("#FF0000"),u.removeClass("table")))}}catch(e){s=!0,l=e}finally{try{o||null==c.return||c.return()}finally{if(s)throw l}}e++}}}}},i=(a(300),a(2)),c=Object(i.a)(l,function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("b-row",{staticClass:"justify-content-center"},[a("h3",{staticClass:"text-center"},[e._v("Représentation du ")]),e._v(" "),a("br"),e._v(" "),e.loadedPerformance?a("h3",{staticClass:"text-center"},[e._v(e._s(e._f("moment")(e.loadedPerformance.date,"dddd Do MMMM YYYY [à] HH:mm")))]):e._e(),e._v(" "),e.loadedPerformance&&e.loadedPerformance.plan?a("b-col",{staticClass:"my-5",attrs:{cols:"12",md:"8"},on:{click:function(t){return e.clickOnTablePlan(t)}}}):e._e(),e._v(" "),e.loadedPlan?a("b-col",{staticClass:"my-5",attrs:{cols:"12",md:"6"},on:{click:function(t){return e.clickOnTablePlan(t)}}},[a("div",{ref:"svgFile",staticClass:"primary-border",domProps:{innerHTML:e._s(e.loadedPlan.svg_plan)}})]):e._e(),e._v(" "),e.loadedPlan?a("modal",{attrs:{selectedTable:e.selectedTable},on:{updateTableColor:e.updateTableColor}}):e._e()],1)},[],!1,null,"677d1768",null);t.default=c.exports},300:function(e,t,a){"use strict";var r=a(55);a.n(r).a},301:function(e,t,a){(e.exports=a(6)(!1)).push([e.i,"[data-v-677d1768] .table:hover {\n  cursor: pointer;\n  fill: #9ACD32;\n}\n.primary-border[data-v-677d1768] {\n  border: 2px solid #9ACD32;\n}",""])},35:function(e,t,a){var r=a(261);"string"==typeof r&&(r=[[e.i,r,""]]);var n={hmr:!0,transform:void 0,insertInto:void 0};a(7)(r,n);r.locals&&(e.exports=r.locals)},55:function(e,t,a){var r=a(301);"string"==typeof r&&(r=[[e.i,r,""]]);var n={hmr:!0,transform:void 0,insertInto:void 0};a(7)(r,n);r.locals&&(e.exports=r.locals)}}]);